{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container my-5">
  <div class="row g-4">
    <!-- Category Filter Section -->
    <div class="col-lg-3">
      <div class="card shadow-sm border-0 rounded-4 h-100">
        <!-- Filter Image -->
        <div class="card-img-top" style="height: 180px; overflow: hidden;">
          <img src="{% static 'images/filter.png' %}" 
               alt="Filter by Category" 
               class="w-100 h-100" 
               style="object-fit: cover;">
        </div>

        <!-- Filter Form -->
        <div class="card-body p-4">
          <form method="GET" action="{% url 'home' %}">
            {% csrf_token %}
            <div class="mb-3">
              <label for="category" class="form-label fw-semibold text-secondary">Select Category</label>
              <select name="category" id="category" class="form-select rounded-3 shadow-sm">
                <option value="">All Categories</option>
                {% for category in categories %}
                <option value="{{ category.id }}"
                  {% if category.id|stringformat:"s" == request.GET.category %} selected {% endif %}>
                  {{ category.name }}
                </option>
                {% endfor %}
              </select>
            </div>
            <button type="submit" class="btn btn-primary w-100 rounded-pill shadow-sm">
              Filter
            </button>
          </form>
        </div>

        <!-- Info Text -->
        <div class="card-footer bg-light border-0 text-center py-3 rounded-bottom">
          <p class="text-muted small mb-0">
            {% if request.GET.category %}
              Showing {{ data|length }} post{% if data|length != 1 %}s{% endif %} in this category.
            {% else %}
              Showing all posts.
            {% endif %}
          </p>
        </div>
      </div>
    </div>

    <!-- Carousel Section -->
    <div class="col-lg-9">
      <div id="postCarousel" class="carousel slide shadow-sm rounded-4 overflow-hidden" data-bs-ride="carousel">
        <div class="carousel-inner">
          {% for post in data %}
          <div class="carousel-item {% if forloop.first %}active{% endif %}">
            <div class="card border-0 h-100">
              <img src="{{ post.image.url }}" 
                   class="card-img-top" 
                   alt="Post Image" 
                   style="object-fit: cover; height: 350px;">
              <div class="card-body text-center p-4">
                <h4 class="fw-bold mb-2">{{ post.title }}</h4>
                <p class="text-muted small mb-2">
                  by <span class="fw-semibold">{{ post.author.first_name }} {{ post.author.last_name }}</span>
                </p>
                <p class="text-muted small">{{ post.content|truncatewords:30 }}</p>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>

        <!-- Controls -->
        <button class="carousel-control-prev" type="button" data-bs-target="#postCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon bg-dark rounded-circle p-2"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#postCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon bg-dark rounded-circle p-2"></span>
        </button>
      </div>
    </div>
  </div>

  <!-- All Posts Section -->
  <div class="row g-4 mt-4">
    {% for post in data %}
    <div class="col-md-6">
      <div class="card h-100 shadow-sm border-0 rounded-4 overflow-hidden">
        <img src="{{ post.image.url }}" 
             class="card-img-top" 
             alt="Post Image" 
             style="object-fit: cover; height: 220px;">
        <div class="card-body d-flex flex-column p-4">
          <h5 class="fw-bold mb-2 text-truncate" title="{{ post.title }}">{{ post.title }}</h5>
          <p class="text-muted small mb-2">
            by <span class="fw-semibold">{{ post.author.first_name }} {{ post.author.last_name }}</span>
          </p>
          <p class="text-muted small flex-grow-1" style="min-height: 60px; overflow: hidden; text-overflow: ellipsis;">
            {{ post.content|truncatewords:25 }}
          </p>
          <div>
            {% for cat in post.category.all %}
            <span class="badge rounded-pill bg-light text-dark border px-3 py-1 small shadow-sm">{{ cat.name }}</span>
            {% empty %}
            <span class="badge rounded-pill bg-secondary px-3 py-1">Uncategorized</span>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <p class="col-12 text-center text-muted">No posts found in this category.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}





